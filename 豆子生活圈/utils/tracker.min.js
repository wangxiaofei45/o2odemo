const tracker=function(e){let r="https://collecter.frontjs.com/",t="0.1.2",n=1,o=256,a=1024;const i=function(e,r){r=r||"";let t={1001:"Invalid token",1002:"Invalid behaviour settings",1003:"Invalid origin settings",1004:"Invalid exclude settings",1005:"Invalid user data",4000:"Bad configuration! Fail to start!",4001:"FrontJS is already defined, Fail to start!"};t[e]&&console.warn(["Error(frontjs):",t[e],"(CODE"+e+")","See https://www.frontjs.com/doc/view/errcode/#"+encodeURIComponent(r)].join(" "))},l=function(e){return e&&e.match(/^\w{32}$/)?0:1},c=function(e){return e<=(14|n)?0:1},s=function(e){e=e||[];for(var r=0;r<e.length;r++)if("string"==typeof e[r]);else if(!e[r].test)return e[r];return 0},u=function(e){for(var r in e=e||{})if("object"==typeof e[r])return r;return 0},f=wx.getSystemInfoSync();let g=null,d=null,p=null,m=0,h=null,v=[/\[(\d|\s|:|-)*\]\s*request\s+(begin|success|fail)/g];const D={KVArrayCopy:function(e){var r={};for(var t in e)r[t]=e[t];return r},uriArrayCopy:function(e){e=e||[];for(var r=[],t=0;t<e.length;t++)"string"==typeof e[t]?r.push(e[t]):r.push(new RegExp(e[t].source,e[t].flag));return r},getTime:function(){return(new Date).getTime()},getGUID:function(){var e=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],r=D.getTime().toString(16);for(r="0"+r;r.length<16;)r="f"+r;for(;r.length<32;)r+=e[Math.floor(16*Math.random())];return r},addSlashes:function(e){return e.replace(/(\.|\\|\/|\||\+|\$|\^)/g,"\\$1")},filterTrace:function(e){var r=new RegExp("((?!\\n).)*"+D.addSlashes("tracker.js")+".*\\n","g");return e.replace(r,"")},getUserAgent:function(){return"N/A"},getCurrentURL:function(){return d},getRefererURL:function(){return g},getViewPortSize:function(){return{w:f.windowWidth,h:f.windowHeight,r:f.pixelRatio}},getClientID:function(){return wx.getStorageSync("frontjs:client:id")||wx.setStorageSync("frontjs:client:id",D.getGUID()),wx.getStorageSync("frontjs:client:id")},getSessionID:function(){return p||(p=D.getGUID()),p},checkCrossOrigin:function(e,r){if(r){e=e||"";for(var t=!1,n=0;n<r.length;n++)e.match(r[n])&&(t|=!0);return!t}return!1},checkIgnorePattern:function(e){if(e)for(var r=0;r<v.length;r++)if(e.match(v[r]))return!0;return!1},checkTimingSlow:function(e,r){return!!r&&(e.send>r.sned&&r.sned>0||e.load>r.load&&r.load>0||e.total>r.total&&r.total>0)},calculateTrackerTiming:function(e){if(e._time_done&&e._time_load&&e._time_send&&e._time_done){var r=e._time_send-e._time_open,t=e._time_load-e._time_send,n=e._time_done-e._time_open;return{send:r=r<0?null:r,load:t=t<0?null:t,total:n=n<0?null:n}}return{send:0,load:0,total:0}},composeTrackerData:function(e,r){return{type:e,data:r}},composeScriptErrorData:function(e,r,t,n,o,a){return a=a&&a.stack?a.stack.toString():"",{message:e,detail:{err:r,file:t,line:n,column:o,trace:a=D.filterTrace(a)}}},composeXHRErrorData:function(e,r,t,n){return{message:e,detail:{requestURL:r,responseData:t,timing:n}}},composeResourceErrorData:function(e,r,t){return{message:e,detail:{tagname:r,resourceURL:t}}},composePerformaceData:function(e,r){return{message:e,detail:r}}};let y=function(e){var t={},o=!0;if(l(e.token)?(i(1001),o&=!1):t.token=e.token.toString(),c(e.behaviour)?(i(1002),o&=!1):(t.behaviour=parseInt(e.behaviour),t.behaviour||(t.behaviour=14|n)),s(e.origin)){var a=s(e.behaviour);i(1003,a),o&=!1}else t.origin=D.uriArrayCopy(e.origin),t.origin.push(/^((?!:\/\/).)*$/),t.origin.push("tracker.js"),t.origin.push(r);return s(e.exclude)?(a=s(e.exclude),i(1004,a),o&=!1):(t.exclude=D.uriArrayCopy(e.exclude),t.exclude.push("tracker.js"),t.exclude.push(r)),u(e.userData)?(a=u(e.userData),i(1005,a),o&=!1):t.userData=D.KVArrayCopy(e.userData),!!o&&t}(e);if(!y)return i(4e3),!1;let w={request:function(e){let r=e[0].success,t=e[0].fail,n=D.getTime(),o=0;e[0].success=function(){o=D.getTime();let t=D.composeXHRErrorData(771,e[0].url,{status:arguments[0].statusCode},{send:0,load:o-n,total:o-n});D.checkCrossOrigin(e[0].url,y.exclude)&&4&y.behaviour&&R(768,t),r&&r.apply(this,[].slice.call(arguments))},e[0].fail=function(){o=D.getTime();let r=D.composeXHRErrorData(769,e[0].url,{status:0},{send:o-n,load:0,total:o-n});D.checkCrossOrigin(e[0].url,y.exclude)&&4&y.behaviour&&R(768,r),t&&t.apply(this,[].slice.call(arguments))}},downloadFile:function(e){let r=e[0].fail;e[0].fail=function(){let t=D.composeResourceErrorData(513,"wx.downloadFile",e[0].url);D.checkCrossOrigin(e[0].url,y.exclude)&&2&y.behaviour&&e[0].url&&R(512,t),r&&r.apply(this,[].slice.call(arguments))}}};if(wx.tracker)return i(4001),null;{let e=wx,r={};for(var S in wx)if(w[S]){let t=S.toString();r[t]=function(){return w[t](arguments),e[t].apply(e,[].slice.call(arguments))}}else r[S]=e[S];r.tracker=!0,wx=r}let k=Page;Page=function(){let e=arguments,r=e[0].onShow,t=e[0].onHide;e[0].onShow=function(){let e=getCurrentPages();g=d,d=e.length>0?e[e.length-1].route:"",m=D.getTime(),r&&r.apply(this,[].slice.call(arguments)),h=D.getGUID();let t=D.composePerformaceData(a,{view:0});R(a,t)},e[0].onHide=function(){let e=D.getTime()-m,r=D.composePerformaceData(a,{view:e});R(a,r),t&&t.apply(this,[].slice.call(arguments))},k.apply(null,[].slice.call(arguments))};let x=App;if(App=function(){let e=arguments,r=e[0].onError;e[0].onError=function(){this.tracker.catch(arguments[0]),r&&r.apply(this,[].slice.call(arguments))},e[0].FrontJS=C,x.apply(null,[].slice.call(arguments))},console){var I=console.log,b=console.warn,E=console.error;console.log=function(){var e=[].slice.call(arguments);if(!e.length)return!0;var r=D.composeScriptErrorData(257,e.join(", ").substr(0,1e3),"via console.log",0,0,new Error(e.join(", ").substr(0,1e3)));y.behaviour&n&&!D.checkIgnorePattern(e.join(", ").substr(0,1e3))&&R(o,r),I.apply(console,e)},console.warn=function(){var e=[].slice.call(arguments);if(!e.length)return!0;var r=D.composeScriptErrorData(258,e.join(", ").substr(0,1e3),"via console.warn",0,0,new Error(e.join(", ").substr(0,1e3)));y.behaviour&n&&R(o,r),b.apply(console,e)},console.error=function(){var e=[].slice.call(arguments);if(!e.length)return!0;var r=D.composeScriptErrorData(259,e.join(", ").substr(0,1e3),"via console.error",0,0,new Error(e.join(", ").substr(0,1e3)));y.behaviour&n&&R(o,r),E.apply(console,e)}}function R(e,n){var o=D.composeTrackerData(e,n);o.currentURL=D.getCurrentURL(),o.refererURL=D.getRefererURL(),o.viewPort=D.getViewPortSize(),o.userAgent=D.getUserAgent(),o.clientID=D.getClientID(),o.sessionID=D.getSessionID(),o.messageID=D.getGUID(),e===a&&(o.messageID=h),o.token=y.token,o.version=t,o.userData=y.userData,setTimeout(function(){var e;e=o,wx.request({url:r,data:e,method:"POST"})},0)}let U=function(e){function r(e){return e.message||(e=new Error(e)),e.error=e,e.filename=e.filename?e.filename:"",e.filename+=" via frontJS try - catch API",e.lineno=e.lineno?e.lineno:0,e.colno=e.colno?e.colno:0,function(e){if(!e.message)return!0;var r=D.composeScriptErrorData(o,e.message,e.filename,e.lineno,e.colno,e.error);D.checkCrossOrigin(e.filename,y.exclude)&&y.behaviour&n&&R(o,r)}(e),null}return{try:function(){var e=arguments[0],t=arguments[1];try{return e.apply(t,[].slice.call(arguments,2))}catch(e){return r(e)}},catch:r,composedTry:function(e,t){return function(){try{return e.apply(t,[].slice.call(arguments))}catch(e){return r(e)}}},addUserData:function(r,t){return e.userData[r]=t,!0},removeUserData:function(r){return delete e.userData[r],!0}}}(y);const C={C:{SCRIPT:n,RESOURCE:2,XHR:4,PERFOMACE:8},V:t,try:U.try,catch:U.catch,composedTry:U.composedTry,addUserData:U.addUserData,removeUserData:U.removeUserData};return C};module.exports=tracker;
//# sourceMappingURL=tracker.min.js.map